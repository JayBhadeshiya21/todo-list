{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Todo-list/todo-list/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: ['query'],\r\n    });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACT,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACb,KAAK;QAAC;KAAQ;AAClB;AAEJ,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///D:/Todo-list/todo-list/app/api/users/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/db';\r\nimport { cookies } from 'next/headers';\r\n\r\nasync function checkAdmin() {\r\n    const cookieStore = await cookies();\r\n    const adminId = cookieStore.get('adminId');\r\n    return !!adminId;\r\n}\r\n\r\nexport async function GET() {\r\n    if (!await checkAdmin()) {\r\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    try {\r\n        const users = await prisma.users.findMany({\r\n            select: {\r\n                UserID: true,\r\n                UserName: true,\r\n                Email: true,\r\n                CreatedAt: true,\r\n                userroles: {\r\n                    select: {\r\n                        roles: {\r\n                            select: {\r\n                                RoleName: true\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            orderBy: { CreatedAt: 'desc' }\r\n        });\r\n\r\n        // Clean & flatten roles\r\n        const safeUsers = users.map(user => ({\r\n            UserID: user.UserID,\r\n            UserName: user.UserName,\r\n            Email: user.Email,\r\n            CreatedAt: user.CreatedAt,\r\n            Roles: user.userroles.map(\r\n                ur => ur.roles.RoleName\r\n            )\r\n        }));\r\n\r\n        return NextResponse.json(safeUsers);\r\n    } catch (error) {\r\n        console.error('Error fetching users:', error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to fetch users' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n    if (!await checkAdmin()) {\r\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    try {\r\n        const body = await request.json();\r\n        const { UserName, Email, PasswordHash, RoleID } = body;\r\n\r\n        if (!UserName || !Email || !PasswordHash) {\r\n            return NextResponse.json(\r\n                { error: 'Missing required fields' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const existingUser = await prisma.users.findFirst({\r\n            where: {\r\n                OR: [\r\n                    { Email },\r\n                    { UserName }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (existingUser) {\r\n            return NextResponse.json(\r\n                { error: 'User with this email or username already exists' },\r\n                { status: 409 }\r\n            );\r\n        }\r\n\r\n        const newUser = await prisma.users.create({\r\n            data: {\r\n                UserName,\r\n                Email,\r\n                PasswordHash, // hash in real apps\r\n            },\r\n        });\r\n\r\n        if (RoleID) {\r\n            await prisma.userroles.create({\r\n                data: {\r\n                    UserID: newUser.UserID,\r\n                    RoleID: parseInt(RoleID)\r\n                }\r\n            });\r\n        }\r\n\r\n        // Never return password\r\n        const { PasswordHash: _, ...safeUser } = newUser;\r\n\r\n        return NextResponse.json(safeUser, { status: 201 });\r\n    } catch (error) {\r\n        console.error('Error creating user:', error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to create user' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,eAAe;IACX,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,UAAU,YAAY,GAAG,CAAC;IAChC,OAAO,CAAC,CAAC;AACb;AAEO,eAAe;IAClB,IAAI,CAAC,MAAM,cAAc;QACrB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,IAAI;QACA,MAAM,QAAQ,MAAM,qHAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACtC,QAAQ;gBACJ,QAAQ;gBACR,UAAU;gBACV,OAAO;gBACP,WAAW;gBACX,WAAW;oBACP,QAAQ;wBACJ,OAAO;4BACH,QAAQ;gCACJ,UAAU;4BACd;wBACJ;oBACJ;gBACJ;YACJ;YACA,SAAS;gBAAE,WAAW;YAAO;QACjC;QAEA,wBAAwB;QACxB,MAAM,YAAY,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACjC,QAAQ,KAAK,MAAM;gBACnB,UAAU,KAAK,QAAQ;gBACvB,OAAO,KAAK,KAAK;gBACjB,WAAW,KAAK,SAAS;gBACzB,OAAO,KAAK,SAAS,CAAC,GAAG,CACrB,CAAA,KAAM,GAAG,KAAK,CAAC,QAAQ;YAE/B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAEtB;AACJ;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI,CAAC,MAAM,cAAc;QACrB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,YAAY,EAAE,MAAM,EAAE,GAAG;QAElD,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,cAAc;YACtC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,eAAe,MAAM,qHAAM,CAAC,KAAK,CAAC,SAAS,CAAC;YAC9C,OAAO;gBACH,IAAI;oBACA;wBAAE;oBAAM;oBACR;wBAAE;oBAAS;iBACd;YACL;QACJ;QAEA,IAAI,cAAc;YACd,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAkD,GAC3D;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,UAAU,MAAM,qHAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACtC,MAAM;gBACF;gBACA;gBACA;YACJ;QACJ;QAEA,IAAI,QAAQ;YACR,MAAM,qHAAM,CAAC,SAAS,CAAC,MAAM,CAAC;gBAC1B,MAAM;oBACF,QAAQ,QAAQ,MAAM;oBACtB,QAAQ,SAAS;gBACrB;YACJ;QACJ;QAEA,wBAAwB;QACxB,MAAM,EAAE,cAAc,CAAC,EAAE,GAAG,UAAU,GAAG;QAEzC,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}